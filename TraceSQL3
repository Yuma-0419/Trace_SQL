--対象URL
　https://github.com/mustafaa7med/Hotel-Management-System-PLSQL/tree/main

--ファイル名
　README.md

--文字数
　約152行

--備考
　参考先のコードを分割して複数回掛けて解析予定

--コード

## 2- Creating Tables

```sql
-- Creating all tables
CREATE TABLE hotel(hotel_id number primary key,
                   hotel_name varchar2(25),
                   hotel_address varchar2(25),
                   hotel_phone varchar2(25)
                   );
　→ ホテルID、ホテル名、住所、電話番号の4項目からなる、ホテル情報を管理するための「hotel」テーブルを作成するSQL。
　 「hotel_id」が主キーとして設定されている。

CREATE TABLE room(room_id number primary key,
                  hotel_id number,
                  room_price number,
                  room_size varchar2(25),
                  room_capacity number,
                  CONSTRAINT room_fk FOREIGN KEY(hotel_id)
                  REFERENCES hotel(hotel_id),
                  CONSTRAINT room_size_ck
                  CHECK (Room_Size in ('small' , 'medium' , 'large' ))
                  );
　→ルームID、ホテルID、価格、サイズ、収容人数の5項目からなる、部屋情報を管理するための「room」テーブルを作成するSQL。
　 「room_id」は主キー、「hotel_id」は「Hotel」テーブルを参照する外部キーとして設定されていて、
　「Room_Size」の値について「small」「medium」「large」のみを許可するチェック制約が設定されている。

CREATE TABLE guest(guest_id number primary key,
                   guest_name varchar2(25),
                   guest_phone varchar2(25),
                   guest_email varchar2(35)
                   );
　→顧客ID、顧客名、電話番号、Eメールアドレスの4項目からなる、顧客情報を管理するための「guest」テーブルを作成するSQL。
　 「guest_id」が主キーとして設定されている。

CREATE TABLE room_reservation(room_id number,
                              guest_id number,
                              booking_id number,
                              booking_invoice number,
                              CONSTRAINT reserv_pk PRIMARY KEY(room_id,guest_id),
                              FOREIGN KEY(room_id) REFERENCES room(room_id),
                              FOREIGN KEY(guest_id) REFERENCES guest(guest_id)
                              );                       
　→ルームID、顧客ID、予約ID、予約請求書の4項目からなる、部屋の予約情報を管理するための「room_reservation」テーブルを作成するSQL。
　 「room_id」は「room」テーブル、「guest_id」は「guest」テーブルを参照する外部キーとして設定されていて、
　 尚且つ「room_id」と「guest_id」からなる複合主キー「reserv_pk」が設定されている。

CREATE TABLE event(event_id number primary key,
                   event_name varchar2(25)
                   );
　→イベントID、イベント名の2項目からなる、イベント情報を管理するための「event」テーブルを作成するSQL。
　 「event_id」が主キーとして設定されている。

CREATE TABLE event_in_hotel(event_id number,
                            guest_id number,
                            reserv_id number,
                            start_date date,
                            end_date date,
                            event_invoice number,
                            CONSTRAINT room_hotel_pk PRIMARY KEY(event_id,guest_id)
                            );
　→イベントID、顧客ID、予約ID、開始日付、終了日付、イベント請求書の6項目からなる、
　 ホテルのイベント情報を管理するための「event_in_hotel」テーブルを作成するSQL。
　 「event_id」と「guest_id」からなる複合主キー「room_hotel_pk」が設定されている。

-- Creating a table that restores the availability of the room
CREATE TABLE room_registry(room_id number, 
                           hotel_id number,
                           registry_date date,
                           room_availability varchar2(25),
                           CONSTRAINT registry_pk PRIMARY KEY(room_id, registry_date),
                           CHECK (Room_Availability in ('available' , 'booked' ))
                           );
　→ルームID・ホテルID・登録日・空き状況の4項目からなる、部屋の空き状況を管理するための「room_registry」テーブルを作成するSQL。
　 「room_id」と「registry_date」からなる複合主キー「registry_pk」と、
　 「Room_Availability」の値について「available」「booked」のみを許可するチェック制約が設定されている。

# Add Hotel 

```sql
-- Creating Sequence for Hotel_id
CREATE SEQUENCE hotel_seq START WITH 1 INCREMENT BY 1 MAXVALUE 999999 ORDER;

　→初期値1、増加分1、最大値999999で、実行順に番号を割り当てるホテルID用シーケンス「hotel_seq」を作成するSQL。

-- Creating a procedure to add new hotels
CREATE OR REPLACE PROCEDURE add_hotel(h_id number,
                                      h_name varchar2,
                                      h_address varchar2,
                                      h_phone varchar2
				      ) IS
BEGIN
    INSERT INTO hotel VALUES(hotel_seq.nextval, h_name, h_address, h_phone);
END;
　→「hotel」テーブルにデータを入力するため、シーケンス「hotel_seq」を用いてホテルIDを順繰りで採番して、
　 他は引数で受け取った情報をINSERTするストアドプロシージャ「add_hotel」を作成するSQL。


# Add Room

```sql
-- Creating Sequence for room_id
CREATE SEQUENCE room_seq START WITH 1 INCREMENT BY 1 MAXVALUE 999999 ORDER;
　→初期値1、増加分1、最大値999999で、実行順に番号を割り当てるルームID用シーケンス「room_seq」を作成するSQL。

-- Creating a procedure to add a new ROOM
CREATE OR REPLACE PROCEDURE add_room(r_id number,
                                     h_id number,
                                     r_price number,
                                     r_size varchar2,
                                     r_capacity number
                                     ) IS
unique_exception EXCEPTION;  
PRAGMA EXCEPTION_INIT(unique_exception, -00001);
                                            
BEGIN
    INSERT INTO room VALUES(room_seq.nextval, h_id, r_price, r_size, r_capacity);
    EXCEPTION
        WHEN unique_exception THEN
            dbms_output.put_line(' The room size has to be one of the following: small, medium, large');
END;
　→「room」テーブルにデータを入力するため、シーケンス「room_seq」を用いてルームIDを順繰りで採番して、
　 他は引数で受け取った情報をINSERTするストアドプロシージャ「add_room」を作成するSQL。
　 例外規定として、「-00001」エラー（一意制約違反）が発生した場合に「 The room size has to be one of the following: small, medium, large」
　 という文言が表示されるように設定されている。

# Add Guest

```sql
-- Creating Sequence for guest_id
CREATE SEQUENCE guest_seq START WITH 1 INCREMENT BY 1 MAXVALUE 999999 ORDER;
　→初期値1、増加分1、最大値999999で、実行順に番号を割り当てる顧客ID用シーケンス「guest_seq」を作成するSQL。

-- Creating a procedure to add a new GUEST
CREATE OR REPLACE PROCEDURE add_guest(g_id number,
                                      g_name varchar2,
                                      g_phone varchar2,
                                      g_email varchar2
                                      ) IS
BEGIN
    INSERT INTO guest VALUES(guest_seq.nextval, g_name, g_phone, g_email);
END;
　→「guest」テーブルにデータを入力するため、シーケンス「guest_seq」を用いて顧客IDを順繰りで採番して、
　 他は引数で受け取った情報をINSERTするストアドプロシージャ「add_guest」を作成するSQL。

# Book Room

```sql
-- Creating Sequence for booking_id
CREATE SEQUENCE book_seq START WITH 1 INCREMENT BY 1 MAXVALUE 999999 ORDER;

-- Creating a procedure to book a reservation
CREATE OR REPLACE PROCEDURE book_room(r_id number,
                                      g_id number,
                                      b_id number,
                                      b_invoice number
                                      ) IS
foreign_exception EXCEPTION;                  
PRAGMA EXCEPTION_INIT(foreign_exception, -02291);       
                                                
BEGIN
    INSERT INTO room_reservation VALUES(r_id, g_id, b_id, b_invoice);
    EXCEPTION
        WHEN no_data_found THEN
                    dbms_output.put_line(g_id || ' Is not a registered guest, Kindly registed the guest before booking a room');
        WHEN foreign_exception THEN
         dbms_output.put_line(' There is a foreign key constraint, Kindly consider the values');
END;


# Add Event

```sql
-- Creating Sequence for event_id
CREATE SEQUENCE event_seq START WITH 1 INCREMENT BY 1 MAXVALUE 999999 ORDER;

-- Creating a procedure to add a new event
CREATE OR REPLACE PROCEDURE add_event(e_id number,
                                      e_name varchar2
                                      ) IS

BEGIN
    INSERT INTO event VALUES(event_seq.nextval, e_name);
END;


# Cancel Room Reservation

```sql
-- Cancelling a room reservation
CREATE OR REPLACE PROCEDURE cancel_room_reservation(r_id number,
                                                    g_id number,
                                                    b_id number
                                                    ) IS
BEGIN
    DELETE FROM room_reservation WHERE room_id = r_id AND guest_id = g_id AND booking_id = b_id;
END;


# 4- Creating Features For
- **Retrieving** hotel, room, guest, room and event details.

# Find Hotel

```sql
-- Creating a function to retrieve a hotel
CREATE OR REPLACE FUNCTION find_hotel(h_id number) RETURN varchar2 IS

v_h_id hotel.hotel_id%type;
v_h_name hotel.hotel_name%type;
v_h_address hotel.hotel_address%type;
v_h_phone hotel.hotel_phone%type;
hotel_details varchar2(150);

BEGIN
    SELECT hotel_id,
           hotel_name,
           hotel_address,
           hotel_phone
    INTO v_h_id,
         v_h_name,
         v_h_address,
         v_h_phone
    FROM hotel
    WHERE hotel_id = h_id;
    hotel_details := 'Hotel name is  ' || v_h_name || ', The address is  ' || v_h_address || ' and the phone number is ' || v_h_phone;
    RETURN hotel_details;
END;

# Find Room

```sql
-- Creating a function to retrieve room details
CREATE OR REPLACE FUNCTION find_room(r_id number) RETURN varchar2 IS

v_room_id room.room_id%type;
v_hotel_id room.hotel_id%type;
v_room_size room.room_size%type;
v_room_capacity room.room_capacity%type;
room_details varchar2(150);

BEGIN
    SELECT room_id,
           hotel_id,
           room_size,
           room_capacity
    INTO v_room_id,
         v_hotel_id,
         v_room_size,
         v_room_capacity
    FROM room
    WHERE room_id = r_id;
    room_details := 'Room ID is  ' ||v_room_id || ' That is in hotel ID  ' || v_hotel_id || ' The room size is  ' || v_room_size || ' and the capacity is  ' || v_room_capacity;
    RETURN room_details;
END;


